<!DOCTYPE html>
<!-- consp11.github.io fdsc  https://consp11.github.io/  -->

<html>
<head>
<title>Обмен симметричными ключами</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
</head>
<body style="white-space: pre-wrap; font-size: 26px">

<a href="../index.html">На главную</a>

<h1>Обмен симметричными ключами</h1>

Обмен симметричными ключами проводится только лично с помощью носителя информации.
В целом, обмен похож на удалённый обмен ключами, но осуществляется только лично (через посредника или напрямую). Отличие состоит в том, что симметричные ключи не посылаются посредством каналов связи. То есть файлы sym.key, после зашифрования, обмениваются посредством обмена флешек.

<a href=./6-flashreq.html>Требования к флешкам, участвующим в обмене</a>


Рома и Коля хотят обменяться симметричными ключами.

1. Генерируются и согласовываются новые асимметричные ключи шифрования. Например, Рома генерирует RSA-ключи и посылает их Коле. Однако, симметричный ключ sym.key не посылается, хотя и генерируются.

Как вариант, и Коля и Рома генерируют RSA-ключи и посылают их друг другу. Но sym.key остаются у каждого свои, они не передаются по сети.


2. sym.key шифруются абсолютно также, как и до этого. Но записываются на флеш-память в зашифрованном виде, следуя инструкциям по <a href=./6-flashreq.html>ссылке выше</a>.

Флеш-память передаётся далее при личной встрече. Если генерация RSA-ключей шла со стороны Ромы, то флеш передаётся со стороны Коли.
Если генерация шла с обоих сторон, то и Рома, и Коля передают друг другу флешки с шифрованными sym.key .
Допускается дополнительно передавать на листах бумаги пароли (или части паролей) от шифрованных файлов. Пароли после расшифровки <a href=./5-paper.html>уничтожаются</a>.
Помните, что на бумаге могут остаться невидимые глазу отпечатки пальцев, которые докажут, что бумага была получена от другого лица (это важно, если это может быть компрометирующим обстоятельством для кого-то из этих лиц).
Если вы боитесь, что бумагу могут скрытно прочитать, то другие части паролей можно передавать через сервисы обмена мгновенными сообщениями. Обе части должны быть стойкими даже по отдельности (быть не менее 25-ти случайных символов).


3. Данные с флеш копируются.
Ключи шифруются и хранятся надёжным способом.
Флеш обязательно <a href=./6-flash.html>перезатирается</a>, несмотря на то, что она была шифрованная.


4. Далее, происходит обмен фразами, которые означают, что ключи успешно расшифрованы. Либо сразу идёт переход к пункту 5.


5. Проверка работоспособности ключей.

1) Рома шлёт Коле некоторое случайное послание, например "0Hz68JjU80QmxDITISjvQZmZ". Оно зашифровано согласованным симметричным ключом (или обоими в согласованном порядке).

2) Коля делает аналогично, например, шлёт "6laqIONfQoM4ToHScjQPlABQe6629Y5V". Это иммитация реального обмена сообщениями.
Оба запоминают то, что послали.

3) Рома расшифровывает послание от Коли. Получает "6laqIONfQoM4ToHScjQPlABQe6629Y5V".

4) Коля получает от Ромы "0Hz68JjU80QmxDITISjvQZmZ".

5) Коля вычисляет хеш от расшифрованного послания и шлёт Роме. Рома шлёт хеш - Коле.

6) Оба проверяют, что хеши верные и сообщают в шифрованном виде об этом друг другу.
Канал связи установлен.


6. Только после этого Рома и Коля могут воспользоваться ключами шифрования для шифрования информации.

7. Сделать иные специальные действия: возможно, уничтожить флешку физически.

Обращу внимание на следующие моменты. 

Пока обе стороны не подтвердили получение ключа шифрования, шифровать что-либо таким ключом нельзя. Потому что ключ, теоретически, может быть похищен или потерян. И тогда уже ключ может попасть не к тем людям, которые смогут расшифровать уже зашифрованное сообщение.

Описанный выше процесс полностью повторяет процесс удалённого согласования ключей. Только вместо защищённого канала связи используется личная передача носителя информации (флешки).

Шифрование необходимо для того, чтобы в случае, если с флешки каким-то способом всё-таки смогли восстановить информацию, она была бы зашифрована. Если вы передаёте флешку лично, это ещё не так важно. Но когда вы передаёте флешку через посредника, то это позволяет доверять посреднику в меньшей степени, так как информация дополнительно защищена шифрованием.


После обмена ключами или иной информацией, <a href=./6-flashreq.html>лучше всего уничтожить флешку физически</a>.

<hr>
Возможные ошибки при согласовании ключей


1. Шифрование информации до того, как вы убедились, что согласовали ключи.
В таком случае, если ключ по каким-то причинам был перехвачен, сообщение могут расшифровать.


2. Хранение ключа шифрования в незашифрованном виде

В случае утери либо изъятия носителя информации ключ может утечь. Кроме этого, зашифрованный ключ тяжелее украсть даже если ваш компьютер взломали.


3. При окончании использования ключ не удаляется безопасно.

Ключ должен быть удалён с обоих сторон после того, как стал не нужен.
Иначе ключ может быть утерян. Конечно, вероятность этого низка, однако безопасное перезатирание ключа сводит эту опасность к совсем малой величине.


4. На время шифрования-расшифрования расшифрованный ключ хранится на носителе информации.
То есть не на диске в оперативной памяти, а в энергонезависимой памяти - на жёстком диске.

В таком случае, следы ключа могут остаться.


5. Не отключили файл подкачки. Тогда диск или информация могла попасть в файл подкачки, то есть быть записанной в нешифрованном виде на диск. То же, что и пункт 4.


6. После расшифрования информации, её поместили на диск в нешифрованном виде.
Очевидно, что информация должна обрабатываться также на диске в оперативной памяти. На энергонезависимых устройствах информация должна быть сохранена только в шифрованном виде.
Иначе её потом смогу восстановить.


7. При работе с расшифрованной информацией в текстовом редакторе не отключено резервное копирование.
Часто текстовые редакторы сохраняют резервные копии. Причём как в директорию файла, так и в служебную директорию на жёстком диске. Что приводит к попаданию редактируемой информации в нешифрованном виде на жёсткий диск.


8. При работе в текстовом редакторе или другой программе с документом, документ имеет "говорящее" название. Грубо говоря, "план террористических атак на 2020 год" или "список членов истребительно-диверсионного отряда".
Несмотря на то, что документ был удалён, за одно такое название можно, как минимум, пару лет просидеть в СИЗО.
Надеюсь, вы не террорист и не экстремист, но смысл понятен.

Если вы журналист, то говорящим названием может стать документ "ПарамоновКА.doc".
Если этот Парамонов К.А. является вашим источником, то ваш источник вряд ли проживёт даже неделю после обыска, проведённого у вас сотрудниками полиции по заказу какой-нибудь местной ОПГ.

Правильное название таких документов "gcfQDNsKN6BwNsMiab.doc". Каталог с описаниями документов вы можете хранить в отдельном зашифрованном файле. После того, как вы выяснили, какие документы вам нужны, нужный отрезок файла-каталога надо скопировать, а полный расшифрованный файл каталога надо перезатереть. Чтобы если сейчас компьютер достался злоумышленнику, он не увидел бы полного каталога.


9. У вас шифрованный диск и вы рассчитываете на то, что всего этого не произойдёт, что выше указано. Весь компьютер надёжно защищён.

Реально, вы всегда должны рассчитывать на то, что ваш компьютер будет захвачен в расшифрованном виде. Не важно, каким образом и как. Просто вы должны рассчитывать, что что-то пойдёт не так, что где-то будет ошибка. Шифровать диск надо всё равно, но это дополнительная мера защиты. Даже если вы не знаете, что с вами могут сделать, помните, что человек допускает ошибки и то, что вам кажется, что всё будет хорошо, не означает, что это так будет.

Кроме этого, обычно на шифрованном диске сложный пароль. Когда вы отходите в туалет, обычно вы этот диск не блокируете, компьютер не отключаете от сети. Так что вас могу застать и в этом месте.

Вас могу отвлечь, отозвать, выбить светошумовой гранатой, у вас вырвут из рук ноутбук, захватом за шею быстро оттащат от компьютера и т.п. Причём человек, который будет вас оттаскивать от компьютера, зайдёт залегендированным образом так, что вы даже не заподозрите его ни в чём, пока не окажетесь на полу.

Даже если вы сидите за компьютером один в комнате за стальной дверью, это не значит, что вас прямо сейчас не будут оттаскивать от компьютера.
Вас, каким-либо хитрым приёмом, могут вынудить один раз в жизни нарушить правила. И вы сами впустите этого человека. Или человек впрыгнет к вам через окно, а решётку на окне взорвёт или вырвет, прицепив к автомобилю (конечно, зависит от решёток и этажности).

В конце концов, снайпер ранит вас или даже убьёт, и вы не сможете ничего выключить. Не забывайте, речь идёт как минимум об ОПГ. А то, что вы журналист или адвокат - кому какое дело.

Даже если вы предусмотрели все эти варианты, старайтесь дублировать меры защиты.


10. Расшифровывается много документов сразу: архив, криптоконтейнер или каталог имён файлов. Причём далеко не все эти документы нужны или относятся к разным источникам.

В случае вашего захвата с такими документами, вы подставите свой источник. Чем больше документов они найдут, тем проще по ним будет установить, кто имел доступ к этой информации или мог получить его. Иногда для этого достаточно даже одного-двух документов, но это уже если совсем плохо: это означает, что в документ были вставлены специальные метки, свидетельствующие о том, кому этот документ направлялся.
Если же меток нет, то один документ, возможно, не повредит вашему источнику. Но не 20-30 документов.


11. Работа с форматами doc, pdf или иными сложными форматами.
Если есть возможность, всегда работайте с форматом txt.
Документы со сложной структурой могут сохранять информацию о том, кто их редактировал или даже просто читал.
В крайнем случае, лучше использовать HTML, чем doc и pdf.
При этом, HTML нужно открывать на виртуальной машине с заблокированным для этой машины интернетом.
Если вы уверены в источнике, вы можете открывать HTML документ из браузера с заблокированными интернетом и JavaScript. Но это некоторый риск. Плюс HTML должен быть сформирован именно вашим источником, а не направлен им как копия документа, которую он получил.
doc и pdf файлы можно открывать только на виртуальной машине, причём лучше всего, если там не будут установлены никакие гостевые дополнения и тому подобные вещи.


<a href=./6-flash.html>Перезатирание флеш-памяти</a>

<a href=./6-flashreq.html>Флешки для обмена</a>

</body>
</html>
